---
title: 'PRJCT'
author: 'MickaÃ«l Canouil, *Ph.D.*'
date: '`r format(Sys.Date(), "%B %d, %Y")`'
monofont: "Source Code Pro"
monofontoptions: "Scale=0.7"
params:
    outputCode: FALSE
    nCores: '`r parallel::detectCores()`'
    theme_dark: FALSE
    dpi: 120
    ggFontSize: 9
output:
    bookdown::html_document2:
        theme: simplex
        toc: true
        toc_depth: 2
        toc_float: 
            collapsed: false
        fig_width: 5
        fig_height: 4
        number_sections: true
        self_containd: true
        mathjax: default
        df_print: kable
    bookdown::pdf_document2:
        toc: true
        toc_depth: 2
        fig_width: 5
        fig_height: 4
        number_sections: true
        df_print: kable
        latex_engine: "pdflatex"
---

```{r setup, include=FALSE}
# rm(list = ls())
options(stringsAsFactors = FALSE)

dir.create(gsub("/PROJECT/", "/DATA/", gsub("Scripts", "KnitrFiles", getwd())), recursive = TRUE, showWarnings = FALSE)

library(knitr)
opts_chunk$set(
    size = 'small',
    include = TRUE, #params$outputCode,
    echo = params$outputCode,
    warning = params$outputCode,
    message = params$outputCode,
    tidy = FALSE,
    crop = TRUE,
    autodep = TRUE,
    # fig.width = 7.5,
    # fig.height = 6,
    fig.align = 'center',
    fig.pos = 'H',
    dpi = params$dpi,
    fig.path = paste0(gsub("/PROJECT/", "/DATA/", getwd()), "KnitrFiles/"),
    cache = FALSE,
    cache.path = paste0(gsub("/PROJECT/", "/DATA/", getwd()), "KnitrFiles/")
)

# Code to resize font size of R code chunks output according to 'size' option (only LATEX)
if (knitr:::is_latex_output()) {
    def.chunk.hook  <- knitr::knit_hooks$get("chunk")
    knitr::knit_hooks$set(chunk = function(x, options) {
        x <- def.chunk.hook(x, options)
        ifelse(options$size != "normalsize", paste0("\\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
    })
} else {}

library(kableExtra)
library(Hmisc)
mykable <- function (
    data, 
    font_size = params$ggFontSize, 
    format.args = list(scientific = -1, digits = 3, big.mark = ","), 
    ...
) {
    colnames(data) <- capitalize(colnames(data))
    if (knitr:::is_latex_output()) {
        options(knitr.table.format = "latex")
        kable(x = data, booktabs = TRUE, format.args = format.args, ...) %>%
            kable_styling(
                latex_options = c("striped", "hold_position"),
                full_width = FALSE,
                position = "center",
                font_size = font_size
            )
    } else {
        options(knitr.table.format = "html")
        kable(x = data, format.args = format.args, ...) %>%
            kable_styling(
                bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE,
                position = "center",
                font_size = font_size
            )
    }
}

### Define nCores
nCores <- params$nCores


### Load packages
library(parallel)
library(grid)
library(scales)
library(tidyverse)
library(broom)
library(viridis)
library(readxl)
library(writexl)
library(cowplot)
library(ggrepel)
library(flashpcaR)
library(ggsignif)
library(qdap)
library(tableone)
library(Hmisc)

null <- sapply(list.files(path = "/disks/PROJECT/Mickael/DEV/Rfunctions/", full.names = TRUE), source)

theme_dark <- params$theme_dark
if (theme_dark) {
    ## Theme Black ON ##
    theme_set(theme_black(base_size = params$ggFontSize))
    plot_grid <- hijack(plot_grid, theme_dark = theme_dark)
    scale_colour_viridis <- hijack(scale_colour_viridis, option = "viridis", begin = 2/5, end = 1, direction = -1)
    scale_fill_viridis <- hijack(scale_fill_viridis, option = "viridis", begin = 2/5, end = 1, direction = -1)
} else {
    theme_set(theme_light(base_size = params$ggFontSize))
    scale_colour_viridis <- hijack(scale_colour_viridis, option = "viridis", begin = 0, end = 4/5)
    scale_fill_viridis <- hijack(scale_fill_viridis, option = "viridis", begin = 0, end = 4/5)
}    

```
