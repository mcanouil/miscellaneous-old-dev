---
title: 'PRJCT'
author: 'MickaÃ«l Canouil, *Ph.D.*'
date: '`r format(Sys.time(), "%B %d, %Y (%Hh%M)")`'
monofont: 'Source Code Pro'
monofontoptions: 'Scale=0.7'
params:
  output_code: FALSE
  n_cores: !r parallel::detectCores()
  dpi: 120
  gg_fontsize: 12
  theme_dark: TRUE
output:
  bookdown::html_document2:
    theme: simplex
    toc: true
    toc_depth: 2
    toc_float: 
      collapsed: false
    fig_width: 6.3
    fig_height: 4.7
    number_sections: true
    self_contained: true
    mathjax: default
    df_print: kable
  pdf_document:
    toc: true
    toc_depth: 2
    fig_width: 6.3
    fig_height: 4.7
    number_sections: true
    df_print: kable
    latex_engine: 'pdflatex'
---

```{r setup, include = FALSE}
options(stringsAsFactors = FALSE)

script_name <- ""
project_directory <- gsub("Scripts", "", getwd())
working_directory <- gsub("/PROJECT/", "/DATATMP/", project_directory)
output_directory <- paste0(working_directory, "/", script_name)

dir.create(paste0(output_directory, "/KnitrFiles/"), recursive = TRUE, showWarnings = FALSE, mode = '0777')


### Load packages and functions
library(tidyverse)
library(broom)
library(scales)
library(parallel)
library(grid)

tidyverse_conflicts()

source("/disks/PROJECT/Rscripts/MC/format_pval.R")
source("/disks/PROJECT/Rscripts/MC/pretty_kable.R")


### Set knitr rmarkdown chunk options
knitr::opts_chunk$set(
  results = "asis",
  size = 'small',
  include = TRUE,
  echo = params$output_code,
  warning = params$output_code,
  message = params$output_code,
  tidy = FALSE,
  crop = TRUE,
  autodep = TRUE,
  fig.align = 'center',
  fig.pos = '!h',
  dpi = params$dpi,
  fig.path = paste0(output_directory, "/KnitrFiles/"),
  cache = FALSE,
  cache.path = paste0(output_directory, "/KnitrFiles/")
)


### Code to resize font size of R code chunks output according to 'size' option (only LATEX)
if (knitr:::is_latex_output()) {
  knitr::knit_hooks$set(chunk = function(x, options) {
    if (options$size != "normalsize") {
      x <- paste0("\\", options$size,"\n\n", x, "\n\n \\normalsize")
    }
    return(x)
  })
}


### Define n_cores
n_cores <- params$n_cores


### Define theme
if (params$theme_dark) {
  source("/disks/PROJECT/Rscripts/MC/theme_black.R")
  theme_set(theme_black(base_size = params$gg_fontsize))
} else {
  theme_set(theme_light(base_size = params$gg_fontsize))
}
```
